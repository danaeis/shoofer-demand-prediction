---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.14.7
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Imports

```{python}
import pandas as pd
```

# Config

```{python}
INPUT_PATH = 'data/labels.parquet'
OUTPUT_PATH = 'data/features.parquet'
```

# Loading Dataset

```{python}
def load_data(path):
    df = pd.read_parquet(path) 
    return df
```

```{python}
rides_df = load_data(INPUT_PATH)
print(f'rides_df shape : {rides_df.shape}')
rides_df.head()
```

# Feature engineering

```{python}
def feature_engineering(dataset):
    locations = dataset['Location'].unique()
    sub_dfs = []
    for location in locations:
        sub_df = rides_df[rides_df['Location'] == location].sort_values('Date', ascending=True)
        sub_df['Previous_day_demand'] = sub_df['Demand'].shift(1)      
        sub_df['Previous_week_demand'] = sub_df['Demand'].shift(7)     
        sub_dfs.append(sub_df)
    df = pd.concat(sub_dfs).reset_index(drop=True)
    df['Day_of_week'] = df['Date'].dt.dayofweek   
    df['Day_of_month'] = df['Date'].dt.day
    features_df = df.filter(items=['Previous_day_demand', 'Previous_week_demand', 'Day_of_week', 'Day_of_month'])
    return features_df
```

```{python}
features_df = feature_engineering(rides_df)
print(f'features_df shape : {features_df.shape}')
features_df.head()
```

# File saving

```{python}
def save_features(dataset, path):
    features_df = dataset.to_parquet(path, index=False)
```

```{python}
save_features(features_df, OUTPUT_PATH)
```
